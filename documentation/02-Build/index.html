<!DOCTYPE html>
<html lang="en" dir=>

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Build Instructions for MLOS Prerequisites See 01-Prerequisites.md for initial build tools setup instructions.
There are different instructions according to the environment setup you chose.
Contents  Build Instructions for MLOS  Prerequisites Contents Docker  Create a new container instance  Using the upstream container image Using the locally built image   Other useful docker commands Start an existing container instance Get a new shell in a running container instance   Linux  CLI: make VSCode   Windows  CLI: msbuild Building with Visual Studio      Docker If you chose to use the Docker build environment and have already built or pulled a container image using the instructions in 01-Prerequisites.">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="" />
<meta property="og:description" content="Build Instructions for MLOS Prerequisites See 01-Prerequisites.md for initial build tools setup instructions.
There are different instructions according to the environment setup you chose.
Contents  Build Instructions for MLOS  Prerequisites Contents Docker  Create a new container instance  Using the upstream container image Using the locally built image   Other useful docker commands Start an existing container instance Get a new shell in a running container instance   Linux  CLI: make VSCode   Windows  CLI: msbuild Building with Visual Studio      Docker If you chose to use the Docker build environment and have already built or pulled a container image using the instructions in 01-Prerequisites." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://microsoft.github.io/MLOS/documentation/02-Build/" />

<title>02 Build | MLOS</title>
<link rel="manifest" href="/MLOS/manifest.json">
<link rel="icon" href="/MLOS/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/MLOS/book.min.6cd8553a6854f4812343f0f0c8baca31271e686434f381fbe3c7226f66639176.css" integrity="sha256-bNhVOmhU9IEjQ/DwyLrKMSceaGQ084H748cib2ZjkXY=">
<script defer src="/MLOS/en.search.min.62e0f3b3738fddaa64ec8403cf2f470858a16968c72295eda79a95bc0d6fb178.js" integrity="sha256-YuDzs3OP3apk7IQDzy9HCFihaWjHIpXtp5qVvA1vsXg="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body dir=>
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/MLOS"><span>MLOS</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>











  <ul>
<li>
<p><a href="/MLOS/documentation/">Documentation</a></p>
<ul>
<li><a href="/MLOS/documentation/01-Prerequisites/">Prerequisites</a></li>
<li><a href="/MLOS/documentation/02-Build/"class=active>Build</a></li>
<li><a href="/MLOS/documentation/04-Test/">Test</a></li>
<li><a href="/MLOS/documentation/CodingStandard/">Coding Standard</a></li>
<li><a href="/MLOS/documentation/MlosArchitecture/">Architecture</a></li>
<li><a href="/MLOS/documentation/RepoOrganization/">Repo Organization</a></li>
</ul>
</li>
<li>
<p><a href="/MLOS/notebooks/">Notebooks</a></p>
<ul>
<li><a href="/MLOS/notebooks/BayesianOptimization/">Bayesian Optimization</a></li>
<li><a href="/MLOS/notebooks/SmartCacheOptimization/">Smart Cache Optimization</a></li>
<li><a href="/MLOS/notebooks/SmartCacheCPP/">Smart Cache Optimization in C++</a></li>
<li><a href="/MLOS/notebooks/LevelDbTuning/">LevelDB External Tuning Example</a></li>
</ul>
</li>
<li>
<p><a href="/MLOS/source/Examples/">E2E Examples</a></p>
<ul>
<li><a href="/MLOS/source/Examples/SmartCache/">Smart Cache</a></li>
</ul>
</li>
<li>
<p>API Documentation</p>
<ul>
<li><a href="/MLOS/python_api/">Python</a></li>
</ul>
</li>
<li>
<p>Component Documentation</p>
<ul>
<li><a href="/MLOS/source/Mlos.SettingsSystem.CodeGen/">Mlos Settings System Code Generation System</a></li>
<li><a href="/MLOS/source/Mlos.Core/doc/">Mlos.Core Shared Memory Communication Channel</a></li>
<li><a href="/MLOS/source/Mlos.Agent.Server/">Mlos.Agent.Server</a></li>
</ul>
</li>
<li>
<p><a href="/MLOS/external/">External Integration</a></p>
</li>
<li>
<p><a href="/MLOS/CODE_OF_CONDUCT/">Code of Conduct</a></p>
</li>
<li>
<p><a href="/MLOS/CONTRIBUTING/">Contributing</a></p>
</li>
<li>
<p><a href="https://github.com/Microsoft/MLOS">MLOS Github Repository</a></p>
</li>
</ul>










</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/MLOS/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>02 Build</strong>

  <label for="toc-control">
    
    <img src="/MLOS/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  <nav id="TableOfContents">
  <ul>
    <li><a href="#prerequisites">Prerequisites</a></li>
    <li><a href="#contents">Contents</a></li>
    <li><a href="#docker">Docker</a>
      <ul>
        <li><a href="#create-a-new-container-instance">Create a new container instance</a></li>
        <li><a href="#other-useful-docker-commands">Other useful docker commands</a></li>
        <li><a href="#start-an-existing-container-instance">Start an existing container instance</a></li>
        <li><a href="#get-a-new-shell-in-a-running-container-instance">Get a new shell in a running container instance</a></li>
      </ul>
    </li>
    <li><a href="#linux">Linux</a>
      <ul>
        <li><a href="#cli-make">CLI: <code>make</code></a></li>
        <li><a href="#vscode">VSCode</a></li>
      </ul>
    </li>
    <li><a href="#windows">Windows</a>
      <ul>
        <li><a href="#cli-msbuild">CLI: <code>msbuild</code></a></li>
        <li><a href="#building-with-visual-studio">Building with Visual Studio</a></li>
      </ul>
    </li>
  </ul>
</nav>


  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="build-instructions-for-mlos">Build Instructions for MLOS</h1>
<h2 id="prerequisites">Prerequisites</h2>
<p>See <a href="/MLOS/documentation/01-Prerequisites/">01-Prerequisites.md</a> for initial build tools setup instructions.</p>
<p>There are different instructions according to the environment setup you chose.</p>
<h2 id="contents">Contents</h2>
<ul>
<li><a href="#build-instructions-for-mlos">Build Instructions for MLOS</a>
<ul>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#contents">Contents</a></li>
<li><a href="#docker">Docker</a>
<ul>
<li><a href="#create-a-new-container-instance">Create a new container instance</a>
<ul>
<li><a href="#using-the-upstream-container-image">Using the upstream container image</a></li>
<li><a href="#using-the-locally-built-image">Using the locally built image</a></li>
</ul>
</li>
<li><a href="#other-useful-docker-commands">Other useful docker commands</a></li>
<li><a href="#start-an-existing-container-instance">Start an existing container instance</a></li>
<li><a href="#get-a-new-shell-in-a-running-container-instance">Get a new shell in a running container instance</a></li>
</ul>
</li>
<li><a href="#linux">Linux</a>
<ul>
<li><a href="#cli-make">CLI: <code>make</code></a></li>
<li><a href="#vscode">VSCode</a></li>
</ul>
</li>
<li><a href="#windows">Windows</a>
<ul>
<li><a href="#cli-msbuild">CLI: <code>msbuild</code></a></li>
<li><a href="#building-with-visual-studio">Building with Visual Studio</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="docker">Docker</h2>
<p>If you chose to use the Docker build environment and have already built or pulled a container image using the instructions in <a href="/MLOS/documentation/01-Prerequisites/#docker">01-Prerequisites.md</a>, then you can start an interactive session using the container image as follows:</p>
<h3 id="create-a-new-container-instance">Create a new container instance</h3>
<h4 id="using-the-upstream-container-image">Using the upstream container image</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">docker run -it -v $PWD:/src/MLOS <span style="color:#ae81ff">\</span>
  --name mlos-build <span style="color:#ae81ff">\</span>
  ghcr.io/microsoft-cisl/mlos/mlos-build-ubuntu-20.04
</code></pre></div><h4 id="using-the-locally-built-image">Using the locally built image</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Run the image:</span>
docker run -it -v $PWD:/src/MLOS <span style="color:#ae81ff">\</span>
  --name mlos-build <span style="color:#ae81ff">\</span>
  mlos-build-ubuntu-20.04
</code></pre></div><blockquote>
<p>Where <code>20.04</code> can also be replaced with another <a href="/MLOS/documentation/01-Prerequisites/#linux-distribution-requirements">supported <code>UbuntuVersion</code></a>.</p>
<p>Note: If you receive an error that the container name already exists, then you can use either the <code>docker rm</code> or <code>docker start</code> commands <a href="#other-useful-docker-commands">below</a> to retry.</p>
<p>The <code>-v $PWD:/src/MLOS</code> option makes the current directory (assumed to be the root of the MLOS repository) available inside the container so that you can edit the code from your host machine, but build it inside the container.</p>
<p>Note that the build artifacts located at <code>out/</code> in the container are kept separate by default, so you can test with multiple containers at a time (e.g. each using different Ubuntu versions).
You can use additional <code>-v /path/to/out-20.04:/src/MLOS/out</code> style arguments to direct that output to a host accessible locations if desired.</p>
</blockquote>
<h3 id="other-useful-docker-commands">Other useful docker commands</h3>
<p>Here are some additional basic docker commands to help manage the container instance.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># List the MLOS related container instances</span>
docker ps -a | grep -i mlos
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Gracefully stop the container instance</span>
docker stop mlos-build
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Forcefully stop the container instance.</span>
docker kill mlos-build
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Remove the container instance.</span>
docker rm mlos-build
</code></pre></div><h3 id="start-an-existing-container-instance">Start an existing container instance</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Start the image if it already exists and was stopped:</span>
docker start -i mlos-build
</code></pre></div><h3 id="get-a-new-shell-in-a-running-container-instance">Get a new shell in a running container instance</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">docker exec -it mlos-build /bin/bash
</code></pre></div><p>Once you have an interactive session in the container, the MLOS source code is available at <code>/src/MLOS</code> and can be built using the same instructions in the <a href="#cli-make">Linux: CLI <code>make</code></a> section below.</p>
<h2 id="linux">Linux</h2>
<h3 id="cli-make">CLI: <code>make</code></h3>
<p>We provide <code>Makefile</code> wrappers to invoke the language specific build systems.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">make
</code></pre></div><blockquote>
<p>This is equivalent to <code>make dotnet-build cmake-build</code></p>
</blockquote>
<p>If you want to switch to a debug build run:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">export CONFIGURATION<span style="color:#f92672">=</span>Debug
make
</code></pre></div><blockquote>
<p>Note: <code>export CONFIGURATION=Release</code> to switch back to <code>Release</code> builds.</p>
</blockquote>
<p>The <code>Makefile</code>s in most source folders are simply wrappers around the <code>cmake</code> build system and allow easier interactive building during development without having to maintain shell environment variables or additional paths.</p>
<p>In general <code>cmake</code> is used for C++ projects, with simple <code>CMakeLists.txt</code> wrappers around <code>dotnet build</code> for their C# dependencies to do code generation.</p>
<p>In top-level directories you can restrict the build to just <code>dotnet</code> wrappers or just <code>cmake</code> wrappers like so:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">make dotnet-build
make dotnet-test
make dotnet-clean

make cmake-build
make cmake-test
make cmake-clean
</code></pre></div><blockquote>
<p>Note: A similar shell environment setup can optionally be obtained with the following</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">source ./scripts/init.linux.sh
</code></pre></div></blockquote>
<p>To build <em>and</em> run the tests below the current directory run</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">make check
</code></pre></div><blockquote>
<p>This is equivalent to <code>make all test</code></p>
</blockquote>
<h3 id="vscode">VSCode</h3>
<p>TODO</p>
<h2 id="windows">Windows</h2>
<p>For the C++ and C# project components, Visual Studio <code>msbuild</code> can be used on Windows systems.</p>
<blockquote>
<p>Note: Visual Studio build tools are available free.<br>
Please see the initial setup instructions linked <a href="#prerequisites">above</a> for details.</p>
</blockquote>
<h3 id="cli-msbuild">CLI: <code>msbuild</code></h3>
<p>To build from the command line on Windows, the Visual Studio build tools need to be added to the shell environment.</p>
<ol>
<li>
<p>Setup the <code>powershell</code> environment to find the Visual Studio build tools.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">.\scripts\init.windows.ps1
</code></pre></div><blockquote>
<p>Note: you can also execute <code>.\scripts\init.windows.cmd</code> if you prefer a <code>cmd</code> environment.</p>
</blockquote>
</li>
<li>
<p>Use <code>msbuild</code> to build the project file in the current directory.</p>
<blockquote>
<p>e.g. when run from the root of the MLOS repo this will recursively build all the projects and run the tests.</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">msbuild /m /r /p:Configuration<span style="color:#f92672">=</span>Release
</code></pre></div><p>Some additional build flags to help provide additional control over the process:</p>
<ul>
<li><code>/m</code> runs a multi-process parallel build process</li>
<li><code>/r</code> is required on first build and git pull to <em>restore</em> any nuget packages required \</li>
<li><code>/fl</code> will optionally produce a msbuild.log file</li>
<li><code>/p:Configuration=Release</code> will perform a non-debug build.
<blockquote>
<p>Note: If omitted, <code>msbuild</code> will produce a Debug build by default.  Debug builds perform no compiler optimizations, so are useful for troubleshooting, but will be more difficult for MLOS to help optimize.</p>
</blockquote>
</li>
<li><code>/p:RunUnitTest=false</code> will temporarily skip running unit tests</li>
<li><code>/p:StyleCopEnabled=false</code> will temporarily skip C# style checks</li>
<li><code>/p:UncrustifyEnabled=false</code> will temporarily skip C++ style checks</li>
<li><code>/p:BuildProjectReferences=false</code> will temporarily only build the current project file, and skip rebuilding its dependencies
(note: this option doesn&rsquo;t work when building <code>.sln</code> files)</li>
</ul>
</li>
</ol>
<h3 id="building-with-visual-studio">Building with Visual Studio</h3>
<blockquote>
<p>Note: Visual Studio 2019 Community Edition is available free.<br>
Please see the initial setup instructions linked <a href="#prerequisites">above</a> for details.</p>
</blockquote>
<p>Opening a <code>*.sln</code> file in the <code>source/</code> directory with Visual Studio 2019 should allow you to build inside the IDE.</p>
<ol>
<li>
<p>Setup the shell environment to find the <code>devenv</code> script provided by Visual Studio.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">.\scripts\init.windows.ps1
</code></pre></div><blockquote>
<p>Note: you can also execute <code>.\scripts\init.windows.cmd</code> if you prefer a <code>cmd</code> environment.</p>
</blockquote>
</li>
<li>
<p>Launch Visual Studio for a given solution:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">devenv Mlos.NetCore.sln
</code></pre></div><p>Alternatively, you can launch <code>devenv</code> for a project and manually add its dependencies to the solution that Visual Studio creates.
For instance:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">devenv Mlos.Core.vcxproj
</code></pre></div></li>
</ol>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>

 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#prerequisites">Prerequisites</a></li>
    <li><a href="#contents">Contents</a></li>
    <li><a href="#docker">Docker</a>
      <ul>
        <li><a href="#create-a-new-container-instance">Create a new container instance</a></li>
        <li><a href="#other-useful-docker-commands">Other useful docker commands</a></li>
        <li><a href="#start-an-existing-container-instance">Start an existing container instance</a></li>
        <li><a href="#get-a-new-shell-in-a-running-container-instance">Get a new shell in a running container instance</a></li>
      </ul>
    </li>
    <li><a href="#linux">Linux</a>
      <ul>
        <li><a href="#cli-make">CLI: <code>make</code></a></li>
        <li><a href="#vscode">VSCode</a></li>
      </ul>
    </li>
    <li><a href="#windows">Windows</a>
      <ul>
        <li><a href="#cli-msbuild">CLI: <code>msbuild</code></a></li>
        <li><a href="#building-with-visual-studio">Building with Visual Studio</a></li>
      </ul>
    </li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  
</body>

</html>












