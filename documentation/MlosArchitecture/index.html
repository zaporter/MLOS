<!DOCTYPE html>
<html lang="en" dir=>

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="MLOS Architecture This document provides a brief overview of the MLOS architecture for supporting Machine Learning Optimized Systems.
 MLOS Architecture  High Level Description  Principles Workflows   Architecture Diagram  Main components Shared Memory Regions Target Process  Mlos.Core Shared Channel   Mlos.Agent  Mlos.NetCore Settings registry assemblies Grpc Server Experiment management     Implementation details    High Level Description At a high level, MLOS provides infrastructure to support instance-specific tuning systems software (e.">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="" />
<meta property="og:description" content="MLOS Architecture This document provides a brief overview of the MLOS architecture for supporting Machine Learning Optimized Systems.
 MLOS Architecture  High Level Description  Principles Workflows   Architecture Diagram  Main components Shared Memory Regions Target Process  Mlos.Core Shared Channel   Mlos.Agent  Mlos.NetCore Settings registry assemblies Grpc Server Experiment management     Implementation details    High Level Description At a high level, MLOS provides infrastructure to support instance-specific tuning systems software (e." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://microsoft.github.io/MLOS/documentation/MlosArchitecture/" />

<title>Mlos Architecture | MLOS</title>
<link rel="manifest" href="/MLOS/manifest.json">
<link rel="icon" href="/MLOS/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/MLOS/book.min.6cd8553a6854f4812343f0f0c8baca31271e686434f381fbe3c7226f66639176.css" integrity="sha256-bNhVOmhU9IEjQ/DwyLrKMSceaGQ084H748cib2ZjkXY=">
<script defer src="/MLOS/en.search.min.4c1d22a3183df6a4b6108d83685274001ccb073a450c5a95627992b0d078883c.js" integrity="sha256-TB0ioxg99qS2EI2DaFJ0ABzLBzpFDFqVYnmSsNB4iDw="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body dir=>
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/MLOS"><span>MLOS</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>











  <ul>
<li>
<p><a href="/MLOS/documentation/">Documentation</a></p>
<ul>
<li><a href="/MLOS/documentation/01-Prerequisites/">Prerequisites</a></li>
<li><a href="/MLOS/documentation/02-Build/">Build</a></li>
<li><a href="/MLOS/documentation/04-Test/">Test</a></li>
<li><a href="/MLOS/documentation/CodingStandard/">Coding Standard</a></li>
<li><a href="/MLOS/documentation/MlosArchitecture/"class=active>Architecture</a></li>
<li><a href="/MLOS/documentation/RepoOrganization/">Repo Organization</a></li>
</ul>
</li>
<li>
<p><a href="/MLOS/notebooks/">Notebooks</a></p>
<ul>
<li><a href="/MLOS/notebooks/BayesianOptimization/">Bayesian Optimization</a></li>
<li><a href="/MLOS/notebooks/SmartCacheOptimization/">Smart Cache Optimization</a></li>
<li><a href="/MLOS/notebooks/SmartCacheCPP/">Smart Cache Optimization in C++</a></li>
<li><a href="/MLOS/notebooks/LevelDbTuning/">LevelDB External Tuning Example</a></li>
</ul>
</li>
<li>
<p><a href="/MLOS/source/Examples/">E2E Examples</a></p>
<ul>
<li><a href="/MLOS/source/Examples/SmartCache/">Smart Cache</a></li>
</ul>
</li>
<li>
<p>API Documentation</p>
<ul>
<li><a href="/MLOS/python_api/">Python</a></li>
</ul>
</li>
<li>
<p>Component Documentation</p>
<ul>
<li><a href="/MLOS/source/Mlos.SettingsSystem.CodeGen/">Mlos Settings System Code Generation System</a></li>
<li><a href="/MLOS/source/Mlos.Core/doc/">Mlos.Core Shared Memory Communication Channel</a></li>
<li><a href="/MLOS/source/Mlos.Agent.Server/">Mlos.Agent.Server</a></li>
</ul>
</li>
<li>
<p><a href="/MLOS/external/">External Integration</a></p>
</li>
<li>
<p><a href="/MLOS/CODE_OF_CONDUCT/">Code of Conduct</a></p>
</li>
<li>
<p><a href="/MLOS/CONTRIBUTING/">Contributing</a></p>
</li>
<li>
<p><a href="https://github.com/Microsoft/MLOS">MLOS Github Repository</a></p>
</li>
</ul>










</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/MLOS/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Mlos Architecture</strong>

  <label for="toc-control">
    
    <img src="/MLOS/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  <nav id="TableOfContents">
  <ul>
    <li><a href="#high-level-description">High Level Description</a>
      <ul>
        <li><a href="#principles">Principles</a></li>
        <li><a href="#workflows">Workflows</a></li>
      </ul>
    </li>
    <li><a href="#architecture-diagram">Architecture Diagram</a>
      <ul>
        <li><a href="#main-components">Main components</a></li>
        <li><a href="#shared-memory-regions">Shared Memory Regions</a></li>
        <li><a href="#target-process">Target Process</a></li>
        <li><a href="#mlosagent">Mlos.Agent</a></li>
      </ul>
    </li>
    <li><a href="#implementation-details">Implementation details</a></li>
  </ul>
</nav>


  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="mlos-architecture">MLOS Architecture</h1>
<p>This document provides a brief overview of the MLOS architecture for supporting <strong>M</strong>achine <strong>L</strong>earning <strong>O</strong>ptimized <strong>S</strong>ystems.</p>
<ul>
<li><a href="#mlos-architecture">MLOS Architecture</a>
<ul>
<li><a href="#high-level-description">High Level Description</a>
<ul>
<li><a href="#principles">Principles</a></li>
<li><a href="#workflows">Workflows</a></li>
</ul>
</li>
<li><a href="#architecture-diagram">Architecture Diagram</a>
<ul>
<li><a href="#main-components">Main components</a></li>
<li><a href="#shared-memory-regions">Shared Memory Regions</a></li>
<li><a href="#target-process">Target Process</a>
<ul>
<li><a href="#mloscore">Mlos.Core</a></li>
<li><a href="#shared-channel">Shared Channel</a></li>
</ul>
</li>
<li><a href="#mlosagent">Mlos.Agent</a>
<ul>
<li><a href="#mlosnetcore">Mlos.NetCore</a></li>
<li><a href="#settings-registry-assemblies">Settings registry assemblies</a></li>
<li><a href="#grpc-server">Grpc Server</a></li>
<li><a href="#experiment-management">Experiment management</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#implementation-details">Implementation details</a></li>
</ul>
</li>
</ul>
<h2 id="high-level-description">High Level Description</h2>
<p>At a high level, MLOS provides infrastructure to support instance-specific tuning systems software (e.g. written in C++) in a trackable and reproducible way.</p>
<p>MLOS does this by focusing on optimizing <em>tunables</em> that exist in code.</p>
<p><em>Tunables</em> can take several forms:</p>
<ul>
<li><em>Build time</em>
<ul>
<li>e.g. inlined constants controlling buffer size or hash function, choice of concrete ADT implementation, etc.</li>
</ul>
</li>
<li><em>Startup</em>
<ul>
<li>e.g. configurations that can only be changed with a process restart</li>
</ul>
</li>
<li><em>Runtime</em>
<ul>
<li>e.g. dynamic settings that can changed between instantiations, queries, or other events.</li>
<li>Some of these may be known at compile-time, while others may only be known at runtime for a specific instance (e.g. number of tables in a database schema).</li>
</ul>
</li>
</ul>
<p>To optimize these tunables, the system needs to be observable.
In other words, it needs to provide additional data (e.g. <em>workload</em>, <em>telemetry</em>, <em>metrics</em>, etc.) about the its operation.
When combined additional information obtained from the system executing the process (e.g. OS/HW metrics), we call this combined set of information the <em>context</em>.</p>
<h3 id="principles">Principles</h3>
<ul>
<li>
<p><em>Separation</em></p>
<p>To support lightweight observable components with minimal impact on the target system&rsquo;s performance, we separate the data aggregation and optimization steps to a (local) <em>external agent</em> process.
It communicates with the target system using <em>shared memory channels</em> for low latency.</p>
</li>
<li>
<p><em>Segmentation</em></p>
<p>To support faster iteration, we allow focusing build-time constant tuning to specific components of the target system using micro benchmarks.</p>
</li>
</ul>
<h3 id="workflows">Workflows</h3>
<p>MLOS workflows take roughly two basic forms:</p>
<ol>
<li>
<p>Build-time optimization</p>
<p><em>Microbenchmarks</em> develepers write for <em>smart components</em> can be used to explore component tunable parameter values either interactively or in the background (e.g. during continuous integration pipelines).</p>
<p>The data collected from those &ldquo;experiments&rdquo; can be captured and explored in Notebook experiences that can then be checked back in with the resulting code change to help support reproducible tests to validate these parameters in the future.</p>
<p>Since these tunables may affect many instances, optimization goals here may focus on robustness in addition to performance or some other metric.</p>
</li>
<li>
<p>Runtime optimization</p>
<p><em>Smart components</em> can be hooked up to receive suggestions from the <em>external agent</em> during runtime for online instance specific optimizations as well.</p>
</li>
</ol>
<h2 id="architecture-diagram">Architecture Diagram</h2>
<p><img src="/MLOS/documentation/images/MLOS_architecture.svg" alt="Mlos Component Architecture Diagram" /></p>
<h3 id="main-components">Main components</h3>
<ul>
<li>
<p><em>Target process</em></p>
<p>This is the MLOS enabled system to tune (e.g. an end-to-end system like SqlServer or <em>Smart</em> micro benchmarks for a component, etc.).
The process contains tunable &ldquo;<em>Smart</em>&rdquo; components that are made observable by the <em>Mlos.Agent</em> by exporting telemetry/metrics over <em>Shared memory channels</em> and are optimized using <em>Mlos.Optimizer.Service</em> suggestions.</p>
</li>
<li>
<p><em>Mlos.Agent</em></p>
<p>The primary responsibility of the <em>Mlos.Agent</em> is to observe the target process and manage the &ldquo;experiments&rdquo;.
The experiments define the aggregates from the telemetry stream and exchange it with <em>Mlos.Optimizer.Service</em>.</p>
</li>
<li>
<p><em>Mlos.Client</em></p>
<p>The <em>Mlos.Client</em> is a utility application that allows us to query the state of shared components and create new experiments.</p>
</li>
<li>
<p><em>Shared memory</em></p>
<p><em>Shared memory</em> regions are used to exchange messages and share the configuration objects between the <em>Target process</em> and the <em>Mlos.Agent</em>.</p>
</li>
<li>
<p><em>Mlos.Optimizer.Service</em></p>
<p><em>Mlos.Optimizer.Service</em> is a Docker instance containing the <em>Mlos.Optimizer</em> and an RDBMS instance (e.g. SqlServer) for storing experiment data, optimizer models, etc.</p>
<p>To exchange the messages between <em>Mlos.Agent</em> experiments and <em>Mlos.Optimizers</em>, the database is currently used as a transport channel.</p>
</li>
</ul>
<h3 id="shared-memory-regions">Shared Memory Regions</h3>
<ul>
<li>
<p><em>Global Shared Memory</em></p>
<p>The primary shared memory entry point.
It used to bootstrap and contains metadata about all other memory regions.
It also includes shared channel synchronization objects.</p>
</li>
<li>
<p><em>Config Shared Memory</em></p>
<p>We store all components&rsquo; configuration in the <em>config shared memory</em> region.
Configuration objects are accessible from the <em>Target process</em> and from <em>Mlos.Agent</em>.</p>
</li>
<li>
<p><em>Control/Telemetry Channel Shared Memory</em></p>
<p>Memory region used (exclusively, no header) to exchange messages from the <em>Target process</em> to <em>Mlos.Agent</em>.</p>
</li>
<li>
<p><em>Feedback Channel Shared Memory</em></p>
<p>A memory region used (exclusively, no header) to exchange messages from <em>Mlos.Agent</em> to <em>Target process</em>.</p>
</li>
</ul>
<p>Some memory regions contain a header block that helps with their identification.
The exceptions are shared channel memory regions, where the channel uses all memory.
Control and Feedback Channels are circular buffers whose size must be a power of two (2<!-- raw HTML omitted --><!-- raw HTML omitted -->N<!-- raw HTML omitted --><!-- raw HTML omitted -->).
Prepending a header would prevent proper alignment which is why all communication channel metadata and synchronization objects are located in the <em>Global Shared Memory</em> region.</p>
<p>See Also: <a href="/MLOS/documentation/../source/Mlos.Core/doc/SharedChannel/">SharedChannel.md</a> for more details about their implementation.</p>
<h3 id="target-process">Target Process</h3>
<h4 id="mloscore">Mlos.Core</h4>
<p><em>Mlos.Core</em> is a (C++) library used inside the target process.
It provides an API to handle shared configs and exchange messages with <em>Mlos.Agent</em> via a shared channel.</p>
<p><em>Mlos.Core</em> contains the following components:</p>
<ul>
<li>
<p><em>MlosContext</em></p>
<p>A class responsible for managing shared memory channels.
It provides methods for sending <em>telemetry</em> and <em>control</em> messages to the <em>Mlos.Agent</em> as well as receiving <em>feedback</em> messages from it.</p>
</li>
<li>
<p><em>SharedConfigManager</em></p>
<p>A class responsible for managing shared configs.
It allows for registering configs in shared memory.</p>
</li>
</ul>
<h4 id="shared-channel">Shared Channel</h4>
<ul>
<li><em>Control Channel</em></li>
<li><em>Feedback Channel</em></li>
</ul>
<h3 id="mlosagent">Mlos.Agent</h3>
<h4 id="mlosnetcore">Mlos.NetCore</h4>
<h4 id="settings-registry-assemblies">Settings registry assemblies</h4>
<h4 id="grpc-server">Grpc Server</h4>
<h4 id="experiment-management">Experiment management</h4>
<h2 id="implementation-details">Implementation details</h2>
<p><a href="/MLOS/documentation/../source/Mlos.Core/doc/SharedChannel/">Shared Memory Channel</a></p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>

 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#high-level-description">High Level Description</a>
      <ul>
        <li><a href="#principles">Principles</a></li>
        <li><a href="#workflows">Workflows</a></li>
      </ul>
    </li>
    <li><a href="#architecture-diagram">Architecture Diagram</a>
      <ul>
        <li><a href="#main-components">Main components</a></li>
        <li><a href="#shared-memory-regions">Shared Memory Regions</a></li>
        <li><a href="#target-process">Target Process</a></li>
        <li><a href="#mlosagent">Mlos.Agent</a></li>
      </ul>
    </li>
    <li><a href="#implementation-details">Implementation details</a></li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  
</body>

</html>












