<!DOCTYPE html>
<html lang="en" dir=>

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Download SmartCacheCPP.ipynb notebook Connecting MLOS to a C&#43;&#43; application This notebook walks through connecting MLOS to a C&#43;&#43; application within a docker container. We will start a docker container, and run an MLOS Agent within it. The MLOS Agent will start the actual application, and communicate with it via a shared memory channel. In this example, the MLOS Agent controls the execution of the workloads on the application, and we will later connect to the agent to optimize the configuration of our application.">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="" />
<meta property="og:description" content="Download SmartCacheCPP.ipynb notebook Connecting MLOS to a C&#43;&#43; application This notebook walks through connecting MLOS to a C&#43;&#43; application within a docker container. We will start a docker container, and run an MLOS Agent within it. The MLOS Agent will start the actual application, and communicate with it via a shared memory channel. In this example, the MLOS Agent controls the execution of the workloads on the application, and we will later connect to the agent to optimize the configuration of our application." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://microsoft.github.io/MLOS/notebooks/SmartCacheCPP/" />

<title>Smart Cache C P P | MLOS</title>
<link rel="manifest" href="/MLOS/manifest.json">
<link rel="icon" href="/MLOS/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/MLOS/book.min.6cd8553a6854f4812343f0f0c8baca31271e686434f381fbe3c7226f66639176.css" integrity="sha256-bNhVOmhU9IEjQ/DwyLrKMSceaGQ084H748cib2ZjkXY=">
<script defer src="/MLOS/en.search.min.4c1d22a3183df6a4b6108d83685274001ccb073a450c5a95627992b0d078883c.js" integrity="sha256-TB0ioxg99qS2EI2DaFJ0ABzLBzpFDFqVYnmSsNB4iDw="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body dir=>
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/MLOS"><span>MLOS</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>











  <ul>
<li>
<p><a href="/MLOS/documentation/">Documentation</a></p>
<ul>
<li><a href="/MLOS/documentation/01-Prerequisites/">Prerequisites</a></li>
<li><a href="/MLOS/documentation/02-Build/">Build</a></li>
<li><a href="/MLOS/documentation/04-Test/">Test</a></li>
<li><a href="/MLOS/documentation/CodingStandard/">Coding Standard</a></li>
<li><a href="/MLOS/documentation/MlosArchitecture/">Architecture</a></li>
<li><a href="/MLOS/documentation/RepoOrganization/">Repo Organization</a></li>
</ul>
</li>
<li>
<p><a href="/MLOS/notebooks/">Notebooks</a></p>
<ul>
<li><a href="/MLOS/notebooks/BayesianOptimization/">Bayesian Optimization</a></li>
<li><a href="/MLOS/notebooks/SmartCacheOptimization/">Smart Cache Optimization</a></li>
<li><a href="/MLOS/notebooks/SmartCacheCPP/"class=active>Smart Cache Optimization in C++</a></li>
<li><a href="/MLOS/notebooks/LevelDbTuning/">LevelDB External Tuning Example</a></li>
</ul>
</li>
<li>
<p><a href="/MLOS/source/Examples/">E2E Examples</a></p>
<ul>
<li><a href="/MLOS/source/Examples/SmartCache/">Smart Cache</a></li>
</ul>
</li>
<li>
<p>API Documentation</p>
<ul>
<li><a href="/MLOS/python_api/">Python</a></li>
</ul>
</li>
<li>
<p>Component Documentation</p>
<ul>
<li><a href="/MLOS/source/Mlos.SettingsSystem.CodeGen/">Mlos Settings System Code Generation System</a></li>
<li><a href="/MLOS/source/Mlos.Core/doc/">Mlos.Core Shared Memory Communication Channel</a></li>
<li><a href="/MLOS/source/Mlos.Agent.Server/">Mlos.Agent.Server</a></li>
</ul>
</li>
<li>
<p><a href="/MLOS/external/">External Integration</a></p>
</li>
<li>
<p><a href="/MLOS/CODE_OF_CONDUCT/">Code of Conduct</a></p>
</li>
<li>
<p><a href="/MLOS/CONTRIBUTING/">Contributing</a></p>
</li>
<li>
<p><a href="https://github.com/Microsoft/MLOS">MLOS Github Repository</a></p>
</li>
</ul>










</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/MLOS/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Smart Cache C P P</strong>

  <label for="toc-control">
    
    <img src="/MLOS/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  <nav id="TableOfContents">
  <ul>
    <li><a href="#building-the-application">Building the application</a></li>
    <li><a href="#starting-the-mlos-agent-and-executing-the-workloads">Starting the MLOS Agent and executing the workloads:</a></li>
    <li><a href="#starting-an-optimizer">Starting an Optimizer</a></li>
    <li><a href="#connecting-the-agent-to-the-optimizer">Connecting the Agent to the Optimizer</a></li>
    <li><a href="#inspecting-results">Inspecting results</a></li>
  </ul>
</nav>


  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="download-smartcachecppipynb-notebookhttpsrawgithubusercontentcommicrosoftmlosmainsourcemlosnotebookssmartcachecppipynb"><a href="https://raw.githubusercontent.com/microsoft/MLOS/main/source/Mlos.Notebooks/SmartCacheCPP.ipynb">Download SmartCacheCPP.ipynb notebook</a></h1>
<h1 id="connecting-mlos-to-a-c-application">Connecting MLOS to a C++ application</h1>
<p>This notebook walks through connecting MLOS to a C++ application within a docker container.
We will start a docker container, and run an MLOS Agent within it. The MLOS Agent will start the actual application, and communicate with it via a shared memory channel.
In this example, the MLOS Agent controls the execution of the workloads on the application, and we will later connect to the agent to optimize the configuration of our application.</p>
<p>The application is a &ldquo;SmartCache&rdquo; similar to the one in the SmartCacheOptimization notebook, though with some more parameters to tune.
The source for this example is in the <a href="https://github.com/Microsoft/MLOS/tree/main/source/Examples/SmartCache"><code>source/Examples/SmartCache</code></a> folder.</p>
<h2 id="building-the-application">Building the application</h2>
<p>To build and run the necessary components for this example you need to create and run a docker image.
To that end, open a separate terminal and go to the MLOS main folder. Within that folder, run the following commands:</p>
<ol>
<li>
<p><a href="https://microsoft.github.io/MLOS/documentation/01-Prerequisites/#build-the-docker-image">Build the Docker image</a> using the <a href="https://github.com/microsoft/MLOS/tree/main/notebooks/../../Dockerfile"><code>Dockerfile</code></a> at the root of the repository.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">docker build --build-arg<span style="color:#f92672">=</span>UbuntuVersion<span style="color:#f92672">=</span>20.04 -t mlos-build-ubuntu-20.04 .
</code></pre></div></li>
<li>
<p><a href="https://microsoft.github.io/MLOS/documentation/02-Build/#create-a-new-container-instance">Run the Docker image</a> you just built.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">docker run -it -v $PWD:/src/MLOS -p 127.0.0.1:50051:50051/tcp <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --name mlos-build mlos-build-ubuntu-20.04
        
</code></pre></div><p>This will open a shell inside the docker container.
We&rsquo;re also exposing port 50051 on the docker container to port 50051 of our host machine.
This will allow us later to connect to the optimizer that runs inside the docker container.</p>
</li>
<li>
<p>Inside the container, <a href="https://microsoft.github.io/MLOS/documentation/02-Build/#cli-make">build the compiled software</a> with <code>make</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">make dotnet-build cmake-build cmake-install
</code></pre></div></li>
</ol>
<p>The relevant output will be at:</p>
<ul>
<li>
<p>Mlos.Agent.Server:</p>
<p>This file corresponds to the main entry point for MLOS, written in C#. You can find the source in
<a href="https://github.com/Microsoft/MLOS/tree/main/source/Mlos.Agent.Server/MlosAgentServer.cs"><code>source/Mlos.Agent.Server/MlosAgentServer.cs</code></a> and the binary at
<code>target/bin/Release/AnyCPU/Mlos.Agent.Server/Mlos.Agent.Server.dll</code></p>
</li>
<li>
<p>SmartCache:</p>
<p>This is the C++ executable that implements the SmartCache and executes some workloads.
You can find the source in <a href="https://github.com/Microsoft/MLOS/tree/main/source/Examples/SmartCache/Main.cpp"><code>source/Examples/SmartCache/Main.cpp</code></a> and the binary at
<code>target/bin/Release/x86_64/SmartCache</code></p>
</li>
<li>
<p>SmartCache.SettingsRegistry:</p>
<p>This is the C# code that declares the configuration options for the SmartCache component, and defines the communication between the the MLOS Agent and the SmartCache component. You can find the source in <a href="https://github.com/Microsoft/MLOS/tree/main/source/Examples/SmartCache/SmartCache.SettingsRegistry/AssemblyInitializer.cs"><code>source/Examples/SmartCache/SmartCache.SettingsRegistry/AssemblyInitializer.cs</code></a> and the binary at <code>target/bin/Release/AnyCPU/SmartCache.SettingsRegistry.dll</code></p>
</li>
<li>
<p>SmartCache.ExperimentSession:</p>
<p>This is the C# code that helps coordinate between the SmartCache component and the Mlos.Agent using the messages defined in the <code>SmartCache.SettingsRegistry</code>.  Its main purpose is to process telemetry messages (e.g. aggregate), relay requests to the optimizer over Grpc (setting up a search space for a new optimizer if necessary or referencing an existing one), and feed the suggestions back to the SmartCache component for reconfiguration.</p>
</li>
</ul>
<h2 id="starting-the-mlos-agent-and-executing-the-workloads">Starting the MLOS Agent and executing the workloads:</h2>
<p>Within the docker container, we can now tell the agent where the configuration options are stored, by setting the <code>--settings-registry-path</code> for the MLOS Agent which will also run the SmartCache executable.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">dotnet target/bin/Release/AnyCPU/Mlos.Agent.Server/Mlos.Agent.Server.dll <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --settings-registry-path target/bin/Release/AnyCPU <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --executable target/bin/Release/x86_64/SmartCache <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --experiment ./target/bin/Release/AnyCPU/SmartCache.ExperimentSession/SmartCache.ExperimentSession.dll
</code></pre></div><p>For a more detailed explanation of what&rsquo;s going on, please see the <a href="https://microsoft.github.io/MLOS/source/Examples/SmartCache#explanation">SmartCache README</a>.</p>
<p>The main loop of <code>SmartCache</code> contains the following:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> observations <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; observations <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">100</span>; observations<span style="color:#f92672">++</span>)
    {
        <span style="color:#75715e">// run 100 observations
</span><span style="color:#75715e"></span>        std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;observations: &#34;</span> <span style="color:#f92672">&lt;&lt;</span> observations <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;

        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">20</span>; i<span style="color:#f92672">++</span>)
        {
            <span style="color:#75715e">// run a workload 20 times
</span><span style="color:#75715e"></span>            CyclicalWorkload(<span style="color:#ae81ff">2048</span>, smartCache);
        }

        <span style="color:#66d9ef">bool</span> isConfigReady <span style="color:#f92672">=</span> false;
        std<span style="color:#f92672">::</span>mutex waitForConfigMutex;
        std<span style="color:#f92672">::</span>condition_variable waitForConfigCondVar;

        <span style="color:#75715e">// Setup a callback.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// OMMITTED
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// [...]
</span><span style="color:#75715e"></span>
        <span style="color:#75715e">// Send a request to obtain a new configuration.
</span><span style="color:#75715e"></span>        SmartCache<span style="color:#f92672">::</span>RequestNewConfigurationMessage msg <span style="color:#f92672">=</span> { <span style="color:#ae81ff">0</span> };
        mlosContext.SendTelemetryMessage(msg);
        <span style="color:#75715e">// wait for MLOS Agent so send a message with a new configuration
</span><span style="color:#75715e"></span>        std<span style="color:#f92672">::</span>unique_lock<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>mutex<span style="color:#f92672">&gt;</span> lock(waitForConfigMutex);
        <span style="color:#66d9ef">while</span> (<span style="color:#f92672">!</span>isConfigReady)
        {
            waitForConfigCondVar.wait(lock);
        }

        config.Update();
        smartCache.Reconfigure();
    }
</code></pre></div><p>After each iteration, a TelemetryMessage is sent to the MLOS Agent, and the SmartCache blocks until it receives a new configuration to run the next workload.
By default, the agent is not connected to any optimizer, and will not change the original configuration, so the workload will just run uninterrupted.</p>
<h2 id="starting-an-optimizer">Starting an Optimizer</h2>
<p>We can now also start an Optimizer service for the MLOS Agent to connect to so that we can actually optimize the parameters for this workload.
As the optimizer is running in a separate process, we need to create a new shell on the running docker container using the following command:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">docker exec -it mlos-build /bin/bash
</code></pre></div><p>Within the container, we now install the Python optimizer service:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">pip install -e source/Mlos.Python/
</code></pre></div><p>And run it:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">start_optimizer_microservice launch --port <span style="color:#ae81ff">50051</span>
</code></pre></div><h2 id="connecting-the-agent-to-the-optimizer">Connecting the Agent to the Optimizer</h2>
<p>Now we can start the agent again, this time also pointing it to the optimizer:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">dotnet target/bin/Release/AnyCPU/Mlos.Agent.Server/Mlos.Agent.Server.dll <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --settings-registry-path ./target/bin/Release/AnyCPU/ <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --executable target/bin/Release/x86_64/SmartCache <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --experiment ./target/bin/Release/AnyCPU/SmartCache.ExperimentSession/SmartCache.ExperimentSession.dll <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --optimizer-uri http://localhost:50051
</code></pre></div><p>This will run the workload again, this time using the optimizer to suggest better configurations. You should see output both in the terminal the agent is running in and in the terminal the OptimizerMicroservice is running in.</p>
<h2 id="inspecting-results">Inspecting results</h2>
<p>After (or even while) the optimization is running, we can connect to the optimizer via another GRPC channel.
The optimizer is running within the docker container, but when we started docker, we exposed the port 50051 as the same port 50051 on the host machine (on which this notebook is running). So we can now connect to the optimizer within the docker container at <code>127.0.0.1:50051</code>.
This assumes this notebook runs in an environment with the <code>mlos</code> Python package installed (<a href="https://microsoft.github.io/MLOS/documentation/01-Prerequisites/#python-quickstart">see the documentation</a>).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> mlos.Grpc.OptimizerMonitor <span style="color:#f92672">import</span> OptimizerMonitor
<span style="color:#f92672">import</span> grpc
<span style="color:#75715e"># create a grpc channel and instantiate the OptimizerMonitor</span>
channel <span style="color:#f92672">=</span> grpc<span style="color:#f92672">.</span>insecure_channel(<span style="color:#e6db74">&#39;127.0.0.1:50051&#39;</span>)
optimizer_monitor <span style="color:#f92672">=</span> OptimizerMonitor(grpc_channel<span style="color:#f92672">=</span>channel)
optimizer_monitor
</code></pre></div><pre><code>OptimizerMonitor(grpc_channel='127.0.0.1:50051')
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># There should be one optimizer running in the docker container</span>
<span style="color:#75715e"># corresponding to the C++ SmartCache optimization problem</span>
<span style="color:#75715e"># An OptimizerMicroservice can run multiple optimizers, which would all be listed here</span>
optimizers <span style="color:#f92672">=</span> optimizer_monitor<span style="color:#f92672">.</span>get_existing_optimizers()
optimizers
</code></pre></div><pre><code>[&lt;mlos.Grpc.BayesianOptimizerProxy.BayesianOptimizerProxy at 0x7fdff5578d90&gt;]
</code></pre>
<p>We can now get the observations exactly the same way as for the Python example in <code>SmartCacheOptimization.ipynb</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">optimizer <span style="color:#f92672">=</span> optimizers[<span style="color:#ae81ff">0</span>]
features_df, objectives_df <span style="color:#f92672">=</span>  optimizer<span style="color:#f92672">.</span>get_all_observations()
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
features, targets <span style="color:#f92672">=</span> optimizer<span style="color:#f92672">.</span>get_all_observations()
data <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat([features, targets], axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
data
</code></pre></div><pre><code>   cache_implementation  lru_cache_config.cache_size  \
0     LeastRecentlyUsed                        100.0   
1      MostRecentlyUsed                          NaN   
2      MostRecentlyUsed                          NaN   
3     LeastRecentlyUsed                       3145.0   
4     LeastRecentlyUsed                       2927.0   
..                  ...                          ...   
95    LeastRecentlyUsed                       3726.0   
96    LeastRecentlyUsed                       3358.0   
97     MostRecentlyUsed                          NaN   
98    LeastRecentlyUsed                       2081.0   
99     MostRecentlyUsed                          NaN   

    mru_cache_config.cache_size   HitRate  
0                           NaN  0.000000  
1                        2352.0  0.950000  
2                        1931.0  0.896165  
3                           NaN  0.950000  
4                           NaN  0.950000  
..                          ...       ...  
95                          NaN  0.950000  
96                          NaN  0.950000  
97                       3321.0  0.950000  
98                          NaN  0.950000  
99                        372.0  0.172643  

[100 rows x 4 columns]
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">lru_data, mru_data <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#39;cache_implementation&#39;</span>)

<span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt
line_lru <span style="color:#f92672">=</span> lru_data[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>plot(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;lru_cache_config.cache_size&#39;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;HitRate&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;LRU&#39;</span>, marker<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;o&#39;</span>, linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;none&#39;</span>, alpha<span style="color:#f92672">=.</span><span style="color:#ae81ff">6</span>)
mru_data[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>plot(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;mru_cache_config.cache_size&#39;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;HitRate&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;MRU&#39;</span>, marker<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;o&#39;</span>, linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;none&#39;</span>, alpha<span style="color:#f92672">=.</span><span style="color:#ae81ff">6</span>, ax<span style="color:#f92672">=</span>plt<span style="color:#f92672">.</span>gca())
plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#34;Cache hitrate&#34;</span>)
plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#34;Cache Size&#34;</span>)
plt<span style="color:#f92672">.</span>legend()
</code></pre></div><pre><code>&lt;matplotlib.legend.Legend at 0x7fdff453aad0&gt;
</code></pre>
<p><img src="/MLOS/notebooks/SmartCacheCPP_files/SmartCacheCPP_15_1.png" alt="png" /></p>
<h1 id="going-further">Going Further</h1>
<ol>
<li>Instead of cache hit rate, use a metric based on runtime (e.g. latency, throughput, etc) as performance metric. Environment (context) sensitive metrics can also be measured (e.g. <a href="https://bduvenhage.me/performance/2019/06/22/high-performance-timer.html">time</a>. How does the signal from the runtime based metric compare to the application specific one (hit rate)? How consistent are the runtime results across multiple runs?</li>
<li>Pick another widely used <a href="https://en.wikipedia.org/wiki/Cache_replacement_policies">cache replacement policy</a> such as LFU and construct a synthetic workload on which you expect this strategy to work well. Implement the policy and workload as part of the SmartCache example, and add a new option to the <code>SmartCache.SettingsRegistry\AssemblyInitializer.cs</code>. Run the optimization again with your new workload. Does the optimizer find that your new policy performs best?</li>
</ol>
<h1 id="download-smartcachecppipynb-notebookhttpsrawgithubusercontentcommicrosoftmlosmainsourcemlosnotebookssmartcachecppipynb-1"><a href="https://raw.githubusercontent.com/microsoft/MLOS/main/source/Mlos.Notebooks/SmartCacheCPP.ipynb">Download SmartCacheCPP.ipynb notebook</a></h1>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>

 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#building-the-application">Building the application</a></li>
    <li><a href="#starting-the-mlos-agent-and-executing-the-workloads">Starting the MLOS Agent and executing the workloads:</a></li>
    <li><a href="#starting-an-optimizer">Starting an Optimizer</a></li>
    <li><a href="#connecting-the-agent-to-the-optimizer">Connecting the Agent to the Optimizer</a></li>
    <li><a href="#inspecting-results">Inspecting results</a></li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  
</body>

</html>












